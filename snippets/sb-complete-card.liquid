{%  stylesheet %}
.sb-complete-card {
  background: var(--sb-ch-bg-color, #f5f7fa);
  border-radius: 12px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  padding: 0;
  border: 1px solid rgba(17,19,20,.32);
  transition: background-color 0.3s ease;
}

.sb-complete-card:hover {
  background-color: #f1f3f7;
}

.sb-complete-card .sb-button a {
  width: 100%;
  min-width: unset;
}

.sb-complete-card .sb-option-text {
  color: var(--sb-ch-fg-color-lightened, #666);
  font-size: 14px;
  font-weight: 400;
  line-height: 1.3;
  display: none;
}

.sb-complete-card__tag {
  background: var(--sb-ch-tag-bg-color, #f5f7fa);
  color: var(--sb-ch-tag-fg-color, #333);
  padding: 8px 24px 10px;
  font-size: 16px;
  line-height: 140%;
  font-weight: 500;
  display: flex;
  justify-content: center;
  align-items: center;
}

.sb-complete-card__card-body {
  display: flex;
  padding: 24px;
  gap: 20px;
  text-decoration: none;
}

.sb-complete-card__image {
  display: flex;
  justify-content: center;
  align-items: center;
}

/* TODO: make this responsive, this matches the design but isn't great */
.sb-complete-card__image img {
  object-fit: cover;
  width: 80px;
  height: auto;
}

.sb-complete-card__content {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.sb-complete-card__heading {
  font-size: 16px;
  font-weight: 600;
  margin: 0;
  padding: 0;
  line-height: 1.3;
  color: var(--sb-ch-fg-color, #333);
}


.sb-complete-card__description {
  font-size: 14px;
  line-height: 1.3;
  color: var(--sb-ch-fg-color-lightened, #666);
}
.sb-complete-card__button-wrapper {
  display: flex;
  flex-direction: column-reverse;
  gap: 16px;
  padding: 0 24px 24px; 
  --sb-fg-color: var(--sb-ch-bg-color, #000);
  --sb-bg-color: var(--sb-ch-fg-color, #fff);
  margin-top: auto;
}

/* TODO turn off once Judge.me has been fixed */
.sb-complete-card .jdgm-preview-badge .jdgm-star.jdgm-star {
  color: var(--sb-accent-color-sticky, #1B73B3)!important;
}
.sb-complete-card .jdgm-prev-badge__text {
  font-size: 14px!important;
  color: #11131499 !important;
}

.sb-complete-card .jdgm-prev-badge {
  font-size: 18px!important;
}

.sb-complete-card .jdgm-star {
  font-size: 14px!important;
  margin-right: 0!important;
  padding-right: 0!important;
}
.sb-complete-card .jdgm-widget * {
  line-height: 1!important;
}

.sb-complete-card__button-wrapper .button {
  min-height: 56px;
  font-weight: 500;
}
.sb-complete-card__button-wrapper .button, .sb-complete-card__button-wrapper .button::before, .sb-complete-card__button-wrapper .button::after {
  border-radius: 6px;
}

.sb-complete-card .sb-complete-card__button:hover {
  opacity: 0.7;
  background: linear-gradient(0deg, rgba(0, 0, 0, 0.32) 0%, rgba(0, 0, 0, 0.32) 100%), #173446;
  color: var(--sb-ch-fg-color, rgba(var(--color-button)));
  border-color: var(--sb-ch-fg-color, rgba(var(--color-button)));
}

.sb-complete-card__button-wrapper .button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.sb-complete-card .product-form {
  width: 100%;
  margin-bottom: 0 !important;
}

.sb-complete-card .product-form .form {
  display: flex;
  flex-direction: column;
  gap: 0;
}

.sb-complete-card .product-form__error-message-wrapper {
  margin-bottom: 1rem;
}

@media screen and (min-width: 768px) {
  .sb-complete-card__image img {
    width: 100%;
    object-fit: contain;
    max-height: 215px;
  }
  .sb-complete-card__card-body {
    flex-direction: column;
    gap: 18px;
  }
  .sb-complete-card .jdgm-widget {
    order: -1;
    min-height: 24px;
  }
  .sb-complete-card__button-wrapper {
    gap: 24px;
    flex-direction: column;
  }
  .sb-complete-card__heading {
    font-size: 22px;
    min-height: 57px;
  }
  .sb-complete-card__description {
    font-size: 16px;
  }
  .sb-complete-card .sb-option-text {
    display: block;
  }
  .sb-complete-card .jdgm-star {
    font-size: 16px!important;
  }
}


{% endstylesheet %}

{% liquid
  assign include_add_to_cart = include_add_to_cart | default: false
  assign button_text = button_text | default: 'Shop Now'
  assign add_to_cart_button_text = add_to_cart_button_text | default: 'Quick Add'
  assign first_variant = product.selected_or_first_available_variant
%}

{%  if product != blank %}
  <div class="sb-complete-card" data-product-id="{{ product.id }}">
    {%  if tag != blank %}
      <div class="sb-complete-card__tag">{{ tag }}</div>
    {% endif %}
    <a class="sb-complete-card__card-body" href="{{ product.url }}">
      <div class="sb-complete-card__image">
        {{ product.featured_image | image_url: width: 400 | image_tag }}
      </div>
      <div class="sb-complete-card__content">
        <h3 class="sb-complete-card__heading">{{ product.title }}</h3>
        <div class='jdgm-widget jdgm-preview-badge' data-id='{{ product.id }}'> 
          {{ product.metafields.judgeme.badge }}
        </div> 
        {% if product.metafields.custom.plp_product_short_description != blank %}
          <div class="sb-complete-card__description">
            {{ product.metafields.custom.plp_product_short_description | strip_html }}
          </div>
        {% endif %}
      </div>
    </a>
    <div class="sb-complete-card__button-wrapper">
      {% render 'sb-option-text', product: product, postfix: 'available' %}
      {% liquid
        if section != blank
          assign button_color = section.settings.ch_fg_color | default: '#000'
          assign button_text_color = section.settings.ch_bg_color | default: '#fff'
        else
          assign button_color = '#000'
          assign button_text_color = '#fff'
        endif
      %}
      
      <a class="button sb-button sb-button--primary sb-complete-card__button"
        style="--sb-ch-fg-color: {{ button_text_color }}; --sb-ch-bg-color: {{ button_color }};"
        aria-label="{{ button_text }} {{ product.title }}"
        href="{{ product.url }}"
      >
        {{ button_text }}
      </a>
      
      {% if include_add_to_cart == true and first_variant != blank %}
        <quick-view-custom class="sb-quick-add__trigger">
          <button type="button" 
            class="button sb-button sb-button--primary sb-complete-card__button btn-{{ product.id }}"
            style="--sb-ch-fg-color: {{ button_text_color }}; --sb-ch-bg-color: {{ button_color }};"
            data-product-id="{{ product.id }}" data-product-handle="{{ product.handle }}">{{ add_to_cart_button_text }}</button>
        </quick-view-custom>
      {% endif %}
    </div>
  </div>
{% endif %}