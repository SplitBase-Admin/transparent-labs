<div class="product-grid-item">
  <a href="{{ product.url }}" class="product-card-url">product card url</a>
  {% assign best-seller = false %}
  {% assign new_arrival = false %}
  {% for tag in product.tags %}
    {% if product.tags contains "best-seller" %}
      {% assign best-seller = true %}
    {% endif %}
    {% if product.tags contains "new" or product.tags contains "New" %}
      {% assign new_arrival = true %}
    {% endif %}
  {% endfor %}
  {% if best-seller %}
    <div class="product-tag">{{ 'products.product.tags.best_seller' | t }}</div>
  {% endif %}
  {% if new_arrival %}
    <div class="product-tag new_arrival">{{ 'products.product.tags.new' | t }}</div>
  {% endif %}
  <!-- Main Product Image Slider -->
  <div class="product_image_slider_embla">
    <div class="embla__container">
      {%- for media in product.media -%}
        <div class="product-media-item embla__slide">
          {% render 'responsive-image-400', image: media %}
        </div>
      {% endfor %}
    </div>
    <div class="embla__controls">
      <button class="embla__button embla__button--prev" type="button" aria-label="Previous slide">‹</button>
      <button class="embla__button embla__button--next" type="button" aria-label="Next slide">›</button>
    </div>
  </div>

  <div class="product-content-wrapper">

    <div class="product-details-wrapper">
      <div class='jdgm-widget jdgm-preview-badge' data-id='{{ product.id }}'> 
        {{ product.metafields.judgeme.badge }}
      </div> 

      <a href="{{ product.url }}" class="product-title">{{ product.title }}</a>

      {% if product.metafields.custom.plp_product_short_description != blank %}
        <div class="product-description">
          {% assign string = product.metafields.custom.plp_product_short_description | strip_html %}
          {{ string }}
        </div>
      {% endif %}
    </div>

    <div class="price-button-wrapper">
      <div class="product-price">
        {% if product.selected_or_first_available_selling_plan_allocation == blank %}
          <div>{{ product.first_available_variant.price | money }}</div>
          <del >{{ product.first_available_variant.compare_at_price | money }}</del>
        {% else %}
          <div  data-price="{{ product.first_available_variant.price | money }}"> {{ product.first_available_variant.price | money }} </div>
          <del >{{ product.first_available_variant.compare_at_price | money }}</del>
        {% endif %}
      </div>

      <div class="shop-now-button">
        {%- if product.selected_or_first_available_variant.available -%}

          {% for option in product.options_with_values %}
            {% if option.name == "Flavor" %}
              {% assign flavor_count = option.values | size %}
            {% endif %}
          {% endfor %}
          
          {%- if template.name == 'collection' -%}
            <a href="{{ product.url }}">
              shop {% if flavor_count > 0 %}{{ flavor_count }} flavors {% else %}now{% endif %} {% render 'right-arrow' %}
            </a>
          {%- else -%}
            <a href="{{ product.url }}">shop {% if flavor_count > 0 %}{{ flavor_count }} flavors {% else %}now{% endif %} {% render 'right-arrow' %}</a>            
          {%- endif -%}          
        {%- else -%}
          {{ 'products.product.sold_out' | t }}
        {%- endif -%}
      </div>
    </div>
  </div>
</div>
