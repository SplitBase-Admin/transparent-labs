{{ 'newsletter-form-mini.css' | asset_url | stylesheet_tag }}

<div class="newsletter-form stay-informed-newsletter-form-mini">
  <div class="newsletter-form-header">
    {% if section.settings.newsletter_heading != blank %}
      <h3 class="newsletter-form-heading">{{ section.settings.newsletter_heading }}</h3>
    {% endif %}
    <div class="newsletter-form-close">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <g clip-path="url(#clip0_5948_5233)">
          <path d="M5.98941 5.98959L18.0102 18.0104M18.0102 5.98959L5.98941 18.0104" stroke="white" stroke-linecap="round"/>
        </g>
        <defs>
          <clipPath id="clip0_5948_5233">
            <rect width="24" height="24" fill="white"/>
          </clipPath>
        </defs>
      </svg>
    </div>
  </div>
  {% if section.settings.newsletter_description != blank %}
    <div class="newsletter-form-desc">
      {{ section.settings.newsletter_description }}
    </div>
  {% endif %}
  
  {% assign new_classes = "submitbtn-" | append: section.id %}
  {% form 'customer', id: 'blog-newsletter-form', class: new_classes %}
    {% if form.posted_successfully? or request.params.customer_posted %}
      <p class="thanks__message">Thanks for subscribing!</p>
    {% elsif form.errors %}
      {% for field in form.errors %}
        <p class="error__message"><em>{{ field }} - {{ form.errors.messages[field] }}</em></p>
      {% endfor %}
    {% endif %}

    <input type="hidden" name="form_location" value="top-newsletter">

    {% if template contains 'password' %}
      <input type="hidden" name="contact[tags]" value="prospect,password page"/>
    {% else %}
      <input type="hidden" name="contact[tags]" value="newsletter" />
    {% endif %}

    <div class="input-button-wrapper">
      <input type="hidden" name="challenge" value="false" />
      <fieldset>
        <label for="Email" class="visually-hidden">Email Address</label>
        <input
          id="Email"
          autocapitalize="off"
          autocorrect="off"
          class="text-input"
          name="contact[email]"
          placeholder="Email Address"
          type="email"
        />
      </fieldset>
      <button id="submitbtn" class="button w-full submitbtn-{{ section.id }}" type="submit">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="10" viewBox="0 0 18 10" fill="none">
          <path d="M1 5L17 5M17 5L12.75 9M17 5L12.75 1" stroke="white" stroke-width="1.28571" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
  
      <p class="error-message" id="newsletter__Error--message">
        {% render 'icon-error' %} {{ 'templates.contact.form.error_message' | t }}
      </p>
   
    </div>
  {% endform %}
</div>



<script>

  // window.addEventListener('load', function () {
  //   const params = new URLSearchParams(window.location.search);

  //   console.log('params:: ',params);

  //   if (params.get('customer_posted') === 'true') {
  //     const widget = document.querySelector('.stay-informed-newsletter-form-mini');
      
  //     if (widget) {
  //       // Defer scroll until after layout is fully painted
  //       requestAnimationFrame(() => {
          
  //           const yOffset = -100; // adjust this offset as needed
  //           const y = widget.getBoundingClientRect().top + window.pageYOffset + yOffset;
  //           window.scrollTo({ top: y, behavior: 'smooth' });
  //          // delay ensures layout is complete
  //       });

  //       // Clean up URL
  //       const url = new URL(window.location);
  //       url.searchParams.delete('customer_posted');
  //       window.history.replaceState({}, '', url);
  //     }
  //   }
  // });

  document.querySelector("button.submitbtn-{{ section.id }}")?.addEventListener("click", function(event) {
    const email = document.querySelector(".submitbtn-{{ section.id }} #Email");
    const errorMessage = document.querySelector(".submitbtn-{{ section.id }} #newsletter__Error--message");
    
    let valid = true;
    email.classList.remove("error-field");
    errorMessage?.classList.remove("show");
    
    if (!email.value.trim() || !email.value.includes("@")) {
      email.classList.add("error-field");
      valid = false;
    }
    
    if (!valid) {
      event.preventDefault(); // Only block if validation fails
      errorMessage?.classList.add("show");
    }
  // else: let the form submit normally
  });

</script>