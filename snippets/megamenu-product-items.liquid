{{ 'new-megamenu.css' | asset_url | stylesheet_tag }}
{{ 'featured-collections.css' | asset_url | stylesheet_tag }}
{{ 'megamenu-product-items.css' | asset_url | stylesheet_tag }}

{% unless block.settings.show %}
  <li class="menu-item-has-children megamenu-product-items menu-item-has-children-m main--menu-items">
    <a href="{{- block.settings.main_url }}" class="main--link {% if block.settings.hide_mobile %}main-menu-title hide--mobile{% endif %} {% if block.settings.show_as_link %}menu_as_link{% endif %}">
      {{- block.settings.main_link }}
      {% render 'icon-chevron-down-light' -%}
      {% if block.settings.show_as_link %}{% render 'right-arrow' %}{% endif %}
    </a>
    <div class="menu-subs menu-mega menu-column-2 new-megamenu-wrapper menu-subs-m {% if block.settings.show_as_link %}hide--mobile{% endif %}" >
      <div class="container new-megamenu-inner">  
        <div class="megamenu-header">
          <h4 class="title">{{ block.settings.main_link }}</h4>
          {% if block.settings.main_url != blank %}
            <a href="{{ block.settings.main_url }}" class="btn_link link" aria-label="Menu Item Button URL">
              <span>View All</span>
              {% render 'right-arrow' %}
            </a>
          {% endif %}
        </div>
        <div class="megamenu-body swiper">
          <div class="megamenu-swiper-container">
            <div class="swiper-wrapper product-item-wrapper">
              {% assign collection_object = collections[block.settings.collection] %}
              {% for product in collection_object.products, limit: 5 %}
                <div class="swiper-slide">
                  <div class="product-grid-item">
                    <a href="{{ product.url }}" class="product-card-url">product card url</a>
                    {% assign best-seller = false %}
                    {% assign new_arrival = false %}
                    {% for tag in product.tags %}
                      {% if product.tags contains "best-seller" %}
                        {% assign best-seller = true %}
                      {% endif %}
                      {% if product.tags contains "new" or product.tags contains "New" %}
                        {% assign new_arrival = true %}
                      {% endif %}
                    {% endfor %}
                    {% if best-seller %}
                      <div class="product-tag">{{ 'products.product.tags.best_seller' | t }}</div>
                    {% endif %}
                    {% if new_arrival %}
                      <div class="product-tag new_arrival">{{ 'products.product.tags.new' | t }}</div>
                    {% endif %}
                    <!-- Main Product Image Slider -->
                    <div class="product_image_slider">
                      <div class="swiper-wrapper">
                          <div class="product-media-item swiper-slide">
                            {% render 'responsive-image', image: product.featured_image %}
                          </div>
                      </div>
                    </div>

                    <div class="product-content-wrapper">
                      <div class="product-details-wrapper">
                        <div class='jdgm-widget jdgm-preview-badge' data-id='{{ product.id }}'> 
                          {{ product.metafields.judgeme.badge }}
                        </div> 
              
                        <a href="{{ product.url }}" class="product-title">{{ product.title }}</a>
    
                        {% if product.metafields.custom.plp_product_short_description != blank %}
                          <div class="product-description">
                            {% assign string = product.metafields.custom.plp_product_short_description | strip_html %}
                            {{ string | truncate: 120 }}
                          </div>
                        {% endif %}
                      </div>

                      <div class="price-button-wrapper">
                        <div class="megamenu-product-price">
                          {% if product.selected_or_first_available_selling_plan_allocation == blank %}
                            <div>{{ product.first_available_variant.price | money }}</div>
                            <del >{{ product.first_available_variant.compare_at_price | money }}</del>
                          {% else %}
                            <div  data-price="{{ product.first_available_variant.price | money }}"> {{ product.first_available_variant.price | money }} </div>
                            <del >{{ product.first_available_variant.compare_at_price | money }}</del>
                          {% endif %}
                        </div>
    
                        <div class="shop-now-button">
                          {%- if product.selected_or_first_available_variant.available -%}
                            {% assign flavor_count = 0 %}
                            {% for option in product.options_with_values %}
                              {% if option.name == "Flavor" %}
                                {% assign flavor_count = option.values | size %}
                              {% endif %}
                            {% endfor %}
                            <a href="{{ product.url }}">shop {% if flavor_count > 0 %}{{ flavor_count }} flavors {% else %}now{% endif %} {% render 'right-arrow' %}</a>
                          {%- else -%}
                            {{ 'products.product.sold_out' | t }}
                          {%- endif -%}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </li>
{% endunless %}


<script>

  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll('.megamenu-swiper-container').forEach(swiperContainer => {
      const megaMenuSwiper = new Swiper(swiperContainer, {
        slidesPerView: 5,
        spaceBetween: 24,
        breakpoints: {
          0: { slidesPerView: 2.30, spaceBetween: 16 },
          993: { slidesPerView: 3, spaceBetween: 24 },
          1280: { slidesPerView: 4, spaceBetween: 24 },
          1440: { slidesPerView: 5, spaceBetween: 24 }
        }
      });
    });
  });

</script>