{{ 'product-key-ingredients.css' | asset_url | stylesheet_tag }}
<script>
// Immediately hide cards beyond the initial set to prevent flash of content
document.addEventListener('DOMContentLoaded', function() {
  const ingredientCards = document.querySelectorAll('.ingredient-card');
  const cardsPerPage = 4;
  
  ingredientCards.forEach((card, index) => {
    if (index >= cardsPerPage) {
      card.style.display = 'none';
    }
  });
});
// Ensure ingredient reference links open in new tab
document.addEventListener('DOMContentLoaded', function() {
  var contentElements = document.getElementsByClassName('ingredient-content');
  for (var i = 0; i < contentElements.length; i++) {
    var anchors = contentElements[i].getElementsByTagName('a');
    for (var j = 0; j < anchors.length; j++) {
      anchors[j].setAttribute('target', '_blank');
    }
  }
});
</script>
<script src="{{ 'product-key-ingredients.js' | asset_url }}" defer></script>

{% assign product_key_ingredients_list = product.metafields.custom.product_key_ingredients_list.value %}

{% if product_key_ingredients_list  %}

  <section class="product-key-ingredients-wrapper"> 
    <div class="product-key-ingredient-section">
      <div class="container">
        <div class="ingredient-section">
          <div class="ingredient-section__header">
            <h2>{{ section.settings.title }}</h2>
            {% if section.settings.description != blank %}
              <div class="ingredient-section__description">{{ section.settings.description }}</div>
            {% endif %}
          </div>
        
          <div class="ingredient-section__grid">
            {% for block in product_key_ingredients_list %}
              <div class="ingredient-card" data-ingredient-index="{{ forloop.index0 }}" {% if forloop.index > 4 %}style="display: none;"{% endif %}>
                  <div class="ingredient-card__content">
                    <div class="ingredient-card__header">
                      <h3 class="ingredient-card__title">{{ block.ingredient_title }}</h3>
                      <button class="ingredient-card__plus-button" aria-label="Open ingredients">
                        {% render 'icon-plus-light' %}
                      </button>
                    </div>
                    <p class="ingredient-card__amount">{{ block.ingredient_weight }}</p>
                    <p class="ingredient-card__description {% if block.ingredient_image_small != blank %}ingredient-image-enabled{% endif %}">{{ block.ingredient_short_description }}</p>
                  </div>
                  <div class="ingredient-card__image">
                    {% if block.ingredient_image_small != blank %}
                      <img src="{{ block.ingredient_image_small | img_url: 'master' }}" alt="{{ block.ingredient_title }}" width="{{ block.ingredient_image_small.value.width }}" height="{{ block.ingredient_image_small.value.height }}">
                    {% else %}
                      {{ 'image' | placeholder_svg_tag }}
                    {% endif %}
                  </div>
                </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    
    <div id="ingredient-modal" class="ingredient-modal">
    <div class="ingredient-modal__overlay"></div>
    <div class="ingredient-modal__content">
      <div class="swiper ingredient-swiper">
        <div class="swiper-wrapper">
          {% for block in product_key_ingredients_list %}
            <div class="swiper-slide {% unless block.ingredient_image_large != blank or block.ingredient_image_small != blank %}modal-ingredient-image-disabled{% endunless %}">
              <button class="ingredient-modal__close">
                {% render 'icon-close' %}
              </button>
              <div class="swiper-slide-content">
                <div class="ingredient-header">
                  <h2 class="ingredient-name">{{ block.ingredient_title }}</h2>
                  <p class="ingredient-amount">{{ block.ingredient_weight }}</p>
                </div>
                
                <div class="ingredient-content">
                  {% if block.ingredient_detailed_description != blank %}
                    {{ block.ingredient_detailed_description | metafield_tag }}
                  {% endif %}
                </div>

                {% if block.ingredient_image_large != blank or block.ingredient_image_small != blank %}
                  <div class="ingredient-image-container">
                    {% if block.ingredient_image_large != blank %}
                      <img src="{{ block.ingredient_image_large | img_url: 'master' }}" alt="{{ block.ingredient_title }}" width="{{ block.ingredient_image_large.value.width }}" height="{{ block.ingredient_image_large.value.height }}" class="ingredient-image">
                    {% else %}
                      <img src="{{ block.ingredient_image_small | img_url: 'master' }}" alt="{{ block.ingredient_title }}" width="{{ block.ingredient_image_small.value.width }}" height="{{ block.ingredient_image_small.value.height }}" class="ingredient-image">
                    {% endif %}
                  </div>
                {% endif %}
              </div>
              </div>
          {% endfor %}
        </div>
  
        <div class="key-ingredient-slider-bottom">
          <!-- Add this right after the pagination dots div -->
          <div class="key-ingredient-pagination"></div>
          <!-- Add this new element -->
          <div class="key-ingredient-fraction"></div>
        </div>
          
      </div>
    </div>
  </div>
  </section>


{% endif %}


{% schema %}
{
  "name": "Ingredient Section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Key Ingredients"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Section Description",
      "default": "Lorem ipsum dolor sit amet consectetur. Sed tincidunt sed tristique a a porttitor sagittis."
    }
  ],
  "blocks": [
    {
      "type": "ingredient",
      "name": "Ingredient",
      "settings": [
        {
          "type": "text",
          "id": "name",
          "label": "Ingredient Name",
          "default": "Ingredient Name"
        },
        {
          "type": "text",
          "id": "amount",
          "label": "Amount",
          "default": "1,000"
        },
        {
          "type": "text",
          "id": "unit",
          "label": "Unit",
          "default": "mg"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Short Description",
          "default": "Brief description of the ingredient and its benefits."
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Ingredient Image"
        },
        {
          "type": "header",
          "content": "Additional Details"
        },
        {
          "type": "text",
          "id": "detail_title_1",
          "label": "Detail Title",
          "default": "Benefits & Research"
        },
        {
          "type": "textarea",
          "id": "detail_content_1",
          "label": "Detail Content",
          "default": "Detailed information about the ingredient benefits.\n\nUse line breaks to create paragraphs."
        },
        {
          "type": "textarea",
          "id": "detail_references_1",
          "label": "References",
          "default": "Journal of Nutrition, 2020\nInternational Journal of Sports Medicine, 2019",
          "info": "One reference per line"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Ingredient Section",
      "blocks": [
        {
          "type": "ingredient",
          "settings": {
            "name": "Creatine Monohydrate",
            "amount": "5,000",
            "unit": "mg",
            "description": "Supplementation with creatine (monohydrate) works by increasing the amount of creatine within your muscle cells (called \"muscle creatine stores\")."
          }
        },
        {
          "type": "ingredient",
          "settings": {
            "name": "β-Hydroxy β-Methylbutyrate",
            "amount": "1,500",
            "unit": "mg",
            "description": "HMB may confer additive effects leading to further improvements in body composition, physical performance, and recovery time."
          }
        },
        {
          "type": "ingredient",
          "settings": {
            "name": "BioPerine®",
            "amount": "5",
            "unit": "mg",
            "description": "The black pepper plant (Piper nigrum) is a flowering vine that bears fruits (peppercorns) containing roughly 2-7.4% piperine by mass."
          }
        },
        {
          "type": "ingredient",
          "settings": {
            "name": "Vitamin D3",
            "amount": "12.5",
            "unit": "mcg (500 IU)",
            "description": "An essential fat-soluble micronutrient that plays a particularly important role in maintaining healthy bones, nervous system function, and muscle mass."
          }
        }
      ]
    }
  ]
}
{% endschema %}
