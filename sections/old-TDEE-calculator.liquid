<style>
  
  super{    color:red;  }
  .tlres {
    position: relative;
}
  .circle {
    top: 13px;}
</style>
<div class="main">
  <div class="xgen-inner">
    <div class="cal-header">
      {% if section.settings.header_image != blank %}
        <img src="{{section.settings.header_image | img_url: 'master'}}" alt="section.settings.header_image">
      {% endif %}

      {% if section.settings.title != blank %}
        <h3 style>{{ section.settings.title }}</h3>
      {% endif %}

      {% if section.settings.detail != blank %}
        <p>{{ section.settings.detail }}</p>
      {% endif %}
    </div>

    <form
      id="email_signup"
      class="tlc-form klaviyo_styling klaviyo_gdpr_embed_SgP6hy"
      action="//manage.kmail-lists.com/subscriptions/subscribe"
      data-ajax-submit="//manage.kmail-lists.com/ajax/subscriptions/subscribe"
      method="GET"
      target="_blank"
    >
      <input type="hidden" name="calculator-name" value="tdee">
      <input type="hidden" name="g" value="SgP6hy">
      <input type="hidden" name="$fields" value="$consent">
      <input type="hidden" name="$list_fields" value="$consent" X>

      <div class="form-group gender">
        <label class="main-label">GENDER</label>
        <input type="radio" class="fgender" name="fgender" value="female" id="female"
        ><label for="female" class="label2">{% render 'xicon-femail' %} Female</label>
        <input type="radio" class="fgender" name="fgender" value="male" checked id="male"
        ><label for="male" class="label2">{% render 'xicon-mail' %} Male</label>
        
      </div>
      <div style="color:red;font-size:10px;" class="height_msg"></div>
      <div class="form-group cominput">
        <label class="main-label">Height<super>*</super></label>
        <div class="input-group">
          <input type="number" name="height" value="" required="" id="height" min="0">
          <input type="radio" name="height-unit" value="cm" id="heightcm"
          ><label for="heightcm" class="label2">cm</label>
          <input type="radio" name="height-unit" value="in" checked id="heightin"
          ><label for="heightin" class="label2">in</label>
        </div>
      </div>

      <div style="color:red;font-size:10px;" class="weight_msg"></div>
      <div class="form-group cominput">
        <label class="main-label">Weight<super>*</super></label>
        <div class="input-group">
          <input type="number" name="weight" value="" required="" id="weight" min="0">
          <input type="radio" name="weight-unit" value="kg" required="" id="weightkg" checked
          ><label for="weightkg" class="label2">kg</label>
          <input type="radio" name="weight-unit" value="lbs" required="" id="weightlbs"
          ><label for="weightlbs" class="label2">lbs</label>
        </div>
      </div>

      <div style="color:red;font-size:10px;" class="age_msg"></div>
      <div class="form-group">
        <label class="main-label">Age<super>*</super></label>
        <div class="input-group">
          <input type="number" id="age" name="age" value="" required="">
          <span>Years</span>
        </div>
      </div>

      <div class="form-group mygoal">
        <!-- add hideshow class to make this option available for womens -->
        <label class="main-label">My Lifestyle</label>
        <div class="input-group">
          <input type="radio" name="activity_factor" value="1.2" checked id="Lifestyleone">
          <label for="Lifestyleone" class="label2">
            {% render 'xicon-sedentary' %}
            <p>
              Sedentary<br>
              <span>Spend most of the day sitting ie. Working on computer, no exercise)</span>
            </p>
            {% render 'xicon-check' %}
          </label>

          <input type="radio" name="activity_factor" value="1.375" id="Lifestyletwo">
          <label for="Lifestyletwo" class="label2">
            {% render 'xicon-light-activity' %}
            <p>
              Light Activity <br>
              <span>Spend a good part of the day on my feet (ie. Teacher, Real Estate)</span>
            </p>
            {% render 'xicon-check' %}
          </label>

          <input type="radio" name="activity_factor" value="1.55" id="Lifestylethree">
          <label for="Lifestylethree" class="label2">
            {% render 'xicon-active' %}
            <p>
              Moderately Active <br>
              <span>Spend a good part of the day doing physical activites (ie. Waitress, UPS Driver)</span>
            </p>
            {% render 'xicon-check' %}
          </label>

          <input type="radio" name="activity_factor" value="1.725" id="Lifestylefour">
          <label for="Lifestylefour" class="label2">
            {% render 'xicon-very-active' %}
            <p>
              Very Active <br>
              <span>Spend a good part of the day doing heavy physical activites (ie. Brick Layer, Mover)</span>
            </p>
            {% render 'xicon-check' %}
          </label>

          <input type="radio" name="activity_factor" value="1.9" id="Lifestylefive">
          <label for="Lifestylefive" class="label2">
            {% render 'xicon-very-active' %}
            <p>
              Extremely Active <br>
              <span>Spend a good part of the day doing heavy physical activites (ie. Brick Layer, Mover)</span>
            </p>
            {% render 'xicon-check' %}
          </label>
        </div>
      </div>

      <div class="form-group mygoal">
        <!-- add hideshow class to make this option available for womens -->
        <label class="main-label">My Goal</label>
        <div class="input-group">
          <input type="radio" name="Goal" value="Lose Weight" checked id="goalone"
          ><label for="goalone" class="label2">
            {%- render 'xicon-lose-weight' %} Lose Weight {% render 'xicon-check' -%}
          </label>
          <input type="radio" name="Goal" value="Get Shredded" id="goaltwo"
          ><label for="goaltwo" class="label2">
            {%- render 'xicon-get-shredded' %} Get Shredded {% render 'xicon-check' -%}
          </label>
          <input type="radio" name="Goal" value="Body Recomposition" id="goalthree"
          ><label for="goalthree" class="label2">
            {%- render 'xicon-body-recomposition' %} Body Recomposition {% render 'xicon-check' -%}
          </label>
          <input type="radio" name="Goal" value="Bulk Up" id="goalfour"
          ><label for="goalfour" class="label2">{% render 'xicon-bulk-up' %} Bulk Up {% render 'xicon-check' %}</label>
        </div>
      </div>

      <div style="color:red;font-size:10px;" class="email_msg"></div>
      <div class="form-group email">
        <label class="main-label">Email Address<super>*</super></label>
        <div class="input-group">
          <input type="text" name="email" placeholder="name@example.com" id="email">
        </div>
      </div>
      <div class="form-group agree">
        <div class="input-group">
          <input type="checkbox" name="term1" id="chkboxone"
          ><label for="chkboxone" class="label2"
            >I understand that the results provided by this calculator are estimations based on scientific and clinical
            data and are not intended to replace advice from a qualified healthcare professional..</label
          >
        </div>
      </div>
      <div class="form-group agree">
        <div class="input-group">
          <input type="checkbox" name="term2" id="chkboxtwo" checked
          ><label for="chkboxtwo" class="label2"
            >Transparent Labs can occationally send me product recommendations and promotional emails.</label
          >
        </div>
      </div>

      <div class="form-group">
        <button type="submit" class="bmrbtn" disabled>Calculate</button>
      </div>
    </form>
    <div class="klaviyo_messages">
      <div class="success_message" style="display:none;"></div>
      <div class="error_message" style="display:none;"></div>
    </div>
     <div class="tlresult-wraper tl-tdee-r" style="display:none;">
        <div class="max-w-7xl mx-auto">
          <div class="xheading">
            <h2 class="tdee-output-one">Your TDEE is 1612 and you need 1934 calories every day</h2>
            <!-- <p>Hit these calories each day to optimize and maintain your performance day to day</p> -->
          </div>
          <div class="tlres">
            <div class="circle-wraper">
              <div class="circle">
                <p class="tdee-output-two">
                  You Need <br>
                  <strong>1934</strong> <br>
                  Cal/day
                </p>
              </div>
            </div>

            <div class="out-wraper">
              <div class="xreslist">
                <i class="xsedentary"></i>
                <span class="xname">Sedentary</span>
                <span class="xcount tdee-cal-one">1934</span>
              </div>

              <div class="xreslist">
                <i class="xlight"></i>
                <span class="xname">Light</span>
                <span class="xcount tdee-cal-two">2217</span>
              </div>

              <div class="xreslist">
                <i class="xmoderate"></i>
                <span class="xname">Moderate</span>
                <span class="xcount tdee-cal-three">2499</span>
              </div>

              <div class="xreslist">
                <i class="xhigh"></i>
                <span class="xname">High</span>
                <span class="xcount tdee-cal-four">2781</span>
              </div>

              <div class="xreslist">
                <i class="xathletic"></i>
                <span class="xname">Athletic</span>
                <span class="xcount tdee-cal-five">3063</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-6xl mx-auto px-4 text-blue-500 bmr-resourse-detail">
    <div class="rich-text py-8 space-y-4">
      {% if section.settings.resources_heading != blank %}
        <h2 class="">{{ section.settings.resources_heading }}</h2>
      {% endif %}
      {% if section.settings.resources_detail != blank %}
        <p class="">{{ section.settings.resources_detail }}</p>
      {% endif %}
      {% if section.settings.references_heading != blank %}
        <h2 class="">{{ section.settings.references_heading }}</h2>
      {% endif %}
      {% if section.settings.references_detail != blank %}
        <p class="">{{ section.settings.references_detail }}</p>
      {% endif %}
    </div>
  </div>

<script type="text/javascript" src="https://www.klaviyo.com/media/js/public/klaviyo_subscribe.js" defer></script>
<script>
  /**
   * Converts form data to URL encoded string
   * @param {HTMLFormElement} form - The form element
   * @returns {string} URL encoded form data
   */
  function serializeForm(form) {
    const formData = new FormData(form);
    const params = new URLSearchParams();
    
    for (const [key, value] of formData.entries()) {
      params.append(key, value);
    }
    
    return params.toString();
  }

  document.addEventListener('DOMContentLoaded', function() {
    const chkboxone = document.getElementById('chkboxone');
    const bmrBtn = document.querySelector('.bmrbtn');
    const heightInput = document.getElementById('height');
    const weightInput = document.getElementById('weight');
    const ageInput = document.getElementById('age');
    const emailInput = document.getElementById('email');
    const heightMsg = document.querySelector('.height_msg');
    const weightMsg = document.querySelector('.weight_msg');
    const ageMsg = document.querySelector('.age_msg');
    const emailMsg = document.querySelector('.email_msg');

    // Klaviyo integration
    if (typeof KlaviyoSubscribe !== 'undefined') {
      KlaviyoSubscribe.attachToForms('#email_signup', {
        success: function($form) {
          console.log($form);
          const form = document.getElementById('email_signup');
          const formdata = serializeForm(form);
          window.location.href = "https://www.transparentlabs.com/pages/calculator-results?" + formdata;
          
          // Get email for tracking
          const email = form.querySelector('[name="email"]').value;
          _learnq.push(['identify', { $email: email }]);
          _learnq.push(['track', 'Signed Up for Newsletter']);
        },
        hide_form_on_success: true,
        extra_properties: {
          $source: '$embed',
          $method_type: "Klaviyo Form",
          $method_id: 'embed',
          $consent_version: 'Embed default text'
        }
      });
    }

    /**
     * Validates email format
     * @param {string} email - Email to validate
     * @returns {boolean} True if email is valid
     */
    function validateEmail(email) {
      const regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
      return regex.test(email);
    }

    /**
     * Checks all form fields and enables/disables submit button
     */
    function checkAllFields() {
      const height = parseFloat(heightInput.value);
      const weight = parseFloat(weightInput.value);
      const age = parseFloat(ageInput.value);
      const email = emailInput.value;
      const emailValid = validateEmail(email);

      // Enable button only if all fields are valid and checkbox is checked
      if (!isNaN(height) && height > 0 &&
          !isNaN(weight) && weight > 0 &&
          !isNaN(age) && age > 0 &&
          emailValid && chkboxone.checked) {
        bmrBtn.disabled = false;
      } else {
        bmrBtn.disabled = true;
      }
    }

    /**
     * Calculates BMR (Basal Metabolic Rate) using Mifflin-St Jeor equation
     * @param {number} age - Age in years
     * @param {string} gender - Gender ('male' or 'female')
     * @param {number} weight - Weight in kg or lbs
     * @param {number} height - Height in cm or inches
     * @param {string} weightUnit - Weight unit ('kg' or 'lbs')
     * @param {string} heightUnit - Height unit ('cm' or 'in')
     * @returns {string|null} BMR value or null if calculation fails
     */
    function calculateBMR(age, gender, weight, height, weightUnit, heightUnit) {
      console.log(age, gender, weight, height, weightUnit, heightUnit);
      
      // Convert weight from lbs to kg if needed
      if (weightUnit === "lbs") {
        weight = weight / 2.205;
      }

      // Convert height from inches to cm if needed
      if (heightUnit === "in") {
        height = height * 2.54;
      }

      // Calculate BMR based on gender using Mifflin-St Jeor equation
      let bmr;
      if (gender === "male") {
        bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
      } else if (gender === "female") {
        bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
      }

      // Return BMR only if it was calculated, otherwise return null
      return bmr ? bmr.toFixed(2) : null;
    }

    // Enable/Disable BMR button based on checkbox state
    chkboxone.addEventListener('change', function() {
      checkAllFields();
    });

    // Height validation
    heightInput.addEventListener('change', function() {
      const height = parseFloat(this.value);
      if (isNaN(height) || height <= 0) {
        heightMsg.textContent = "Please enter a valid height greater than 0!";
        bmrBtn.disabled = true;
      } else {
        heightMsg.textContent = "";
        checkAllFields();
      }
    });

    // Weight validation
    weightInput.addEventListener('change', function() {
      const weight = parseFloat(this.value);
      if (isNaN(weight) || weight <= 0) {
        weightMsg.textContent = "Please enter a valid weight greater than 0!";
        bmrBtn.disabled = true;
      } else {
        weightMsg.textContent = "";
        checkAllFields();
      }
    });

    // Age validation
    ageInput.addEventListener('change', function() {
      const age = parseFloat(this.value);
      if (isNaN(age) || age <= 0) {
        ageMsg.textContent = "Please enter a valid age greater than 0!";
        bmrBtn.disabled = true;
      } else {
        ageMsg.textContent = "";
        checkAllFields();
      }
    });

    // Email validation
    emailInput.addEventListener('change', function() {
      const email = this.value;
      const emailValid = validateEmail(email);

      if (!emailValid) {
        emailMsg.textContent = "Please enter a valid email!";
        bmrBtn.disabled = true;
      } else {
        emailMsg.textContent = "";
        checkAllFields();
      }
    });

    // Handle BMR button click event
    bmrBtn.addEventListener('click', function(event) {
      event.preventDefault();

      const gender = document.querySelector("input[name='fgender']:checked").value;
      const heightUnit = document.querySelector("input[name='height-unit']:checked").value;
      const weightUnit = document.querySelector("input[name='weight-unit']:checked").value;
      const height = parseFloat(heightInput.value);
      const weight = parseFloat(weightInput.value);
      const age = parseFloat(ageInput.value);
      const email = emailInput.value;
      const activityfactor = parseFloat(document.querySelector("input[name='activity_factor']:checked").value);

      // Initialize flag to check if there are validation errors
      let flag = 0;

      // Check each field for final validation
      if (isNaN(height) || height <= 0) {
        heightMsg.textContent = "Please enter a valid height greater than 0!";
        flag = 1;
      }
      if (isNaN(weight) || weight <= 0) {
        weightMsg.textContent = "Please enter a valid weight greater than 0!";
        flag = 1;
      }
      if (isNaN(age) || age <= 0) {
        ageMsg.textContent = "Please enter a valid age greater than 0!";
        flag = 1;
      }
      if (!validateEmail(email)) {
        emailMsg.textContent = "Please enter a valid email!";
        flag = 1;
      }

      // Submit the form if no validation errors
      if (flag === 0) {
        // Calculate BMR and TDEE
        const BMR = calculateBMR(age, gender, weight, height, weightUnit, heightUnit);
        
        // Show results elements
        const resultsElements = document.querySelectorAll('.results');
        resultsElements.forEach(el => el.style.display = 'block');
        
        const bmrAnswerElement = document.querySelector('.bmranswer');
        if (bmrAnswerElement) {
          bmrAnswerElement.textContent = "Your BMR is: " + BMR;
        }
        
        console.log(activityfactor);
        const tdee = BMR * activityfactor;
        const fixed_tdee = tdee.toFixed();
        console.log(fixed_tdee);
        
        // Update TDEE output elements
        const tdeeOutputOne = document.querySelector('.tdee-output-one');
        if (tdeeOutputOne) {
          tdeeOutputOne.textContent = fixed_tdee + " calories per day.";
        }
        
        const tdeeOutputTwo = document.querySelector('.tdee-output-two');
        if (tdeeOutputTwo) {
          tdeeOutputTwo.innerHTML = "<span style='color:#6C787C;'>You Need</span> <br><strong>" + fixed_tdee + "</strong> <br><span style='color:#6C787C;'>Cal/day</span>";
        }

        // Calculate different activity levels
        const sedentary = (BMR * 1.2).toFixed();
        const lightlyActive = (BMR * 1.375).toFixed();
        const moderatelyActive = (BMR * 1.55).toFixed();
        const veryActive = (BMR * 1.725).toFixed();
        const extraActive = (BMR * 1.9).toFixed();

        // Update activity level outputs
        const tdeeCalOne = document.querySelector('.tdee-cal-one');
        if (tdeeCalOne) tdeeCalOne.textContent = sedentary;
        
        const tdeeCalTwo = document.querySelector('.tdee-cal-two');
        if (tdeeCalTwo) tdeeCalTwo.textContent = lightlyActive;
        
        const tdeeCalThree = document.querySelector('.tdee-cal-three');
        if (tdeeCalThree) tdeeCalThree.textContent = moderatelyActive;
        
        const tdeeCalFour = document.querySelector('.tdee-cal-four');
        if (tdeeCalFour) tdeeCalFour.textContent = veryActive;
        
        const tdeeCalFive = document.querySelector('.tdee-cal-five');
        if (tdeeCalFive) tdeeCalFive.textContent = extraActive;

        // Show results with smooth animation
        const tlTdeeR = document.querySelector('.tl-tdee-r');
        if (tlTdeeR) {
          tlTdeeR.style.display = 'block';
          tlTdeeR.style.opacity = '0';
          tlTdeeR.style.transition = 'opacity 0.5s ease-in-out';
          setTimeout(() => {
            tlTdeeR.style.opacity = '1';
          }, 10);
        }
      }
    });
  });
</script>

{% schema %}
  {
    "name": "TDEE-calculator",
    "class": "td-legacy",
    "settings": [
	{
		"type":"image_picker",
		"id":"header_image",
		"label":"Choose image"
	},
	{
		"type":"text",
		"id":"title",
		"label":"Title"
	},
	{
		"type":"textarea",
		"id":"detail",
		"label":"Subtitle"
	},
	{
    	"type":"text",
        "id":"resources_heading",
        "label":"Resources heading"
	},
    {
        "type":"richtext",
        "id":"resources_detail",
        "label":"Resources details"
    },
    {
        "type":"text",
        "id":"references_heading",
        "label":"References heading"
     },
    {
    	"type":"richtext",
    	"id":"references_detail",
    	"label":"References details"
    }
],
"presets":[
		{
			"name": "TDEE-calculator"
		}
	]
  }
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}


 