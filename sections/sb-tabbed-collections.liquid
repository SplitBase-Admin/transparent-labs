{%  stylesheet %}
  .sb-tabbed-collection:not([data-tab-active="true"]) {
    display: none;
  }
  
  .sb-tabbed-collections {
    background-color: var(--sb-bg-color, #ffffff);
    color: var(--sb-fg-color, #111314);
  }

  .sb-tabbed-collections__content{
    display: flex;
    flex-direction: column;
    gap: 24px;
  }
  
  .sb-tabbed-collections .sb-content__heading {
    font-family: var(--sb-font-family-heading);
    font-size: 28px;
    line-height: 1.2;
    color: var(--sb-fg-color, #111314);
    margin: 0;
  }
  
  .sb-tabbed-collections__header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
    width: 100%;
  }

  .sb-tabbed-collections__header .sb-button{
    overflow: visible;
  }
  
  .sb-tabbed-collections__tags {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    width: 100%;
  }
  
  .sb-tabbed-collections__tags-tag {
    padding: 6.5px 12px 7.5px;
    border-radius: 80px;
    border: 1px solid rgba(17, 19, 20, 0.4);
    font-family: var(--sb-font-family-body);
    font-weight: 400;
    font-size: 16px;
    line-height: 1.3;
    letter-spacing: 0px;
    cursor: pointer;
    background-color: transparent;
    color: rgba(17, 19, 20, 0.8);
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-block;
    height: 33px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .sb-tabbed-collections__tags-tag:hover {
    background-color: var(--sb-fg-color, #111314);
    color: #ffffff;
    border-color: var(--sb-fg-color, #111314);
  }
  
  .sb-tabbed-collections__tags-tag[data-tab-active="true"] {
    background-color: var(--sb-fg-color, #111314);
    color: #ffffff;
    border-color: var(--sb-fg-color, #111314);
  }

  .sb-tabbed-collection .sb-product-card {
    width: auto;
  }

  .sb-tabbed-collection .sb-product-card .jdgm-prev-badge__text,
  .sb-tabbed-collection .sb-product-card .jdgm-star.jdgm--on:before,
  .sb-tabbed-collection .sb-product-card .jdgm-star.jdgm--half:before,
  .sb-tabbed-collection .sb-product-card .jdgm-star.jdgm--off:before {
    font-size: 14px;
  }

  .sb-tabbed-collection .sb-pagination-wrapper {
    padding-inline: var(--sb-padding-inline);
    margin-top: 24px;
  }

  .sb-tabbed-collection .sb-product-card{
    width: auto;
    box-sizing: border-box;
  }

  .sb-tabbed-collection__slider .swiper-slide {
    height: auto;
  }

  .sb-tabbed-collection{
    opacity: 0;
    transition: opacity 1.5s ease-in-out;
    max-height: 800px;
    overflow: hidden;
  }
  .sb-tabbed-collection:has(.sb-tabbed-collection__slide[style*="width"]) {
    opacity: 1;
  }
  .sb-tabbed-collection .sb-button__link--link.sb-button__link {
    line-height: 22px;
  }
  
  /* Mobile responsive */
  @media (max-width: 768px) {
    .sb-tabbed-collections__header {
      gap: 16px;
    }
  }
  @media screen and (min-width: 1024px){
    .sb-tabbed-collections .sb-content__heading {
      font-size: 40px;
    }
    .sb-tabbed-collections .sb-product-card{
      min-height: 443px;
    }
    .sb-tabbed-collections__tags {
      gap: 10px;
    }
  }
  @media screen and (min-width: 1280px){
    .sb-tabbed-collections .sb-product-card {
      min-height: 477px;
    }
    .sb-tabbed-collection {
      max-width: var(--page-width, 1420px);
      margin: 0 auto;
      padding: 0 var(--sb-padding-inline);
      box-sizing: border-box;
      width: 100%;
    }
    .sb-tabbed-collection .sb-pagination-wrapper {
      padding-right: 0;
    }
  }
  @media screen and (min-width: 1920px){
    .sb-tabbed-collection {
      max-height: 1200px;
      padding: 0;
    }
  }
{% endstylesheet %}

<script
  src="{{ 'section-sb-tabbed-groupings.js' | asset_url }}"
  defer
></script>

{% if section.settings.collections != blank %}
  {% liquid
    unless collection
      for child_collection in section.settings.collections
        assign collection = child_collection
        break
      endfor
    endunless
  %}
  <sb-tabbed-grouping>
    <div class="sb-tabbed-collections sb-styled-element" style="{%  render 'style-attributes', settings: section.settings, mobile_multiple: 0.54 %}">
      <div class="sb-content__container">
        <div class="sb-tabbed-collections__content">
          <div class="sb-tabbed-collections__header sb-page-width">
            {% if section.settings.heading != blank %}
              <h2 class="sb-content__heading">{{ section.settings.heading }}</h2>
            {% endif %}
            {% render 'sb-button', button_text: section.settings.link_text, button_url: collection.url, button_type: 'link', additional_attributes: 'data-view-all' %}
          </div>
          
          <div class="sb-tabbed-collections__tags sb-page-width">
            {% for setting_collection in section.settings.collections %}
              <div
                class="sb-tabbed-collections__tags-tag"
                data-tab-selector
                data-tab-active="{% if setting_collection == collection %}true{% else %}false{% endif %}"
                data-item-id="{{ setting_collection.id }}"
                data-url="{{ setting_collection.url }}"
              >
                {%- if setting_collection.metafields.custom.short_title != blank -%}
                  {{ setting_collection.metafields.custom.short_title }}
                {%- else -%}
                  {{ setting_collection.title }}
                {%- endif -%}
              </div>
            {% endfor %}
          </div>
          
          {% for setting_collection in section.settings.collections %}
            <div class="sb-tabbed-collection" data-tab-content data-tab-active="{% if setting_collection == collection %}true{% else %}false{% endif %}" data-item-id="{{ setting_collection.id }}">
              <div class="sb-tabbed-collection__slider-wrapper">
                {% liquid
                  if forloop.first and section.index < 4
                    assign first_image_loading = 'eager'
                  else
                    assign first_image_loading = 'lazy'
                  endif
                  assign slides = null | sort
                  for product in setting_collection.products, limit: section.settings.products_to_show
                    capture slide_content
                      render 'product-card', product: product, first_image_loading: first_image_loading, disable_slider: section.settings.disable_slider
                    endcapture
                    capture slide_content
                      render 'swiper-slide', children: slide_content, classes: 'sb-tabbed-collection__slide'
                    endcapture
                    assign slide_content = slide_content | sort
                    assign slides = slides | concat: slide_content
                  endfor
                  if slides.size > 0
                    content_for 'block', type: '_slider', id: 'static-slider', children: slides, classes: 'sb-tabbed-collection__slider'
                  else
                    render 'sb-no-content', context: "collection products"
                  endif
                %}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </sb-tabbed-grouping>
{% endif %}
{% schema %}
{
  "name": "SB Tabbed Collections",
  "settings": [
    {
      "type": "header",
      "content": "General"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "text",
      "id": "link_text",
      "label": "Link Text"
    },
    {
      "type": "collection_list",
      "id": "collections",
      "label": "Collections"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Products To Show",
      "max": 20,
      "min": 1,
      "step": 1,
      "unit": "Crd",
      "default": 5
    },
    {
      "type": "checkbox",
      "id": "disable_slider",
      "label": "Disable Product Card Slider",
      "default": false,
      "info": "Nesting sliders can have negative performance impacts."
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "paragraph",
      "content": "Main Section Colors"
    },
    {
      "type": "color",
      "id": "fg_color",
      "label": "Color"
    },
    {
      "type": "color_background",
      "id": "bg_color",
      "label": "Background Color"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color"
    },
    {
      "type": "paragraph",
      "content": "Card Colors"
    },
    {
      "type": "color",
      "id": "ch_fg_color",
      "label": "Color"
    },
    {
      "type": "color_background",
      "id": "ch_bg_color",
      "label": "Background Color"
    },
    {
      "type": "color",
      "id": "ch_accent_color",
      "label": "Accent Color"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding Top",
      "default": 0,
      "min": 0,
      "max": 100
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding Bottom",
      "default": 0,
      "min": 0,
      "max": 100
    }
  ],
  "presets": [
    {
      "name": "SB Tabbed Collections"
    }
  ]
}
{% endschema %}
