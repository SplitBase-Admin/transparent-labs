{{ 'featured-collections.css' | asset_url | stylesheet_tag }}

<section class="featured-collections-tabs">
  <div class="container">
    <div class="section-header">
      {% if section.settings.heading != blank %}
        <h2>{{ section.settings.heading }}</h2>
        {% for block in section.blocks %}<a href="{{ block.settings.collection.url }}" class="tab-collection-link {% if forloop.first %}active{% endif %}" data-id="{{ block.id }}">view All {% render 'right-arrow' %}</a>{% endfor %}
      {% endif %}
    </div>
    <div class="collection-tabs tabs">
      {% for block in section.blocks %}
        <a 
          class="tab-button {% if forloop.first %}active{% endif %}" 
          data-tab="{{ block.id }}"
          data-tab-index="{{ forloop.index0 }}" href="#tab-{{ block.id }}">
          {% if block.settings.collection_title != blank %}{{ block.settings.collection_title }}{% else %}{{ block.settings.collection.title }}{% endif %}
        </a>
      {% endfor %}
    </div>
  
    <div class="tab-content">
    {% for block in section.blocks %}
      {% assign collection_object = collections[block.settings.collection] %}
      {% if collection_object %}
        <div 
          class="tab-panel {% if forloop.first %}active{% endif %}" 
          id="{{ block.id }}">
          
          <div class="collection-swiper-container collection-swiper-container-temp">
            <div class="swiper-wrapper product-item-wrapper">
              {% for product in collection_object.products, limit: 7 %}
                <div class="swiper-slide">
                  {%- render 'custom-product-grid',
                     product: product
                  -%}
                </div>
              {% endfor %}
            </div>
            <div class="featured-collections-slider-bottom">
              <div class="featured-collections-pagination"></div>
              <!-- Fractional Pagination (Slide Counter) -->
              <div class="featured-collections-fraction slider-counter-fraction"></div>
            </div>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>
  </div>
</section>


<!-- <script>
  window.swiperBreakpoints = {
    400: { slidesPerView: 1.4, spaceBetween: 24 },
    520: { slidesPerView: 1.9, spaceBetween: 24 },
    640: { slidesPerView: 2.2, spaceBetween: 24 },
    1024: { slidesPerView: 3 },
    1280: { slidesPerView: 4 }
  };
  
  document.addEventListener("DOMContentLoaded", () => {
    let swiperInstances = [];
  
    // Initialize Swiper sliders for collection containers
    document.querySelectorAll('.collection-swiper-container').forEach(swiperContainer => {
      const collectionSwiper = new Swiper(swiperContainer, {
        slidesPerView: 1.175,
        spaceBetween: 24,
        pagination: {
          el: ".featured-collections-pagination",
          clickable: true
        },
        breakpoints: window.swiperBreakpoints,
        on: {
          init: function () {
            window.updateFraction(this, '.featured-collections-fraction');
          },
          slideChange: function () {
            window.updateFraction(this, '.featured-collections-fraction');
          }
        }
      });
  
      swiperInstances.push(collectionSwiper);
    });
  
    // Initialize Swiper sliders for product image containers
    document.querySelectorAll('.product_image_slider').forEach(productImages => {
      new Swiper(productImages, {
        slidesPerView: 1,
        spaceBetween: 16,
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev'
        }
      });
    });
  
    // Handle tab switching logic
    const tabs = document.querySelectorAll(".tab-button");
    const panels = document.querySelectorAll(".tab-panel");
    const collectionLinks = document.querySelectorAll(".tab-collection-link");
  
    tabs.forEach(tab => {
      tab.addEventListener("click", event => {
        event.preventDefault();
        tabs.forEach(t => t.classList.remove("active"));
        panels.forEach(p => p.classList.remove("active"));
        collectionLinks.forEach(c => c.classList.remove("active"));
        panels.forEach(el => {
          el.querySelector(".featured-collections-fraction").innerHTML = "";
        })
  
        tab.classList.add("active");
        const panelId = tab.dataset.tab;
        const activePanel = document.getElementById(panelId);
        activePanel.classList.add("active");
        document.querySelector(`.tab-collection-link[data-id="${panelId}"]`).classList.add("active");
  
        setTimeout(function(){
          // Update fraction for the active swiper
          const activeSwiper = swiperInstances.find(swiper =>
            swiper.el.closest(`#${panelId}`)
          );
          if (activeSwiper) {
            window.updateFraction(activeSwiper, '.featured-collections-fraction');
          }
        }, 500)
      });
    });
  
    // Handle window resize to update fraction
    window.addEventListener("resize", () => {
      const activeTab = document.querySelector(".tab-button.active");
      if (activeTab) {
        const panelId = activeTab.dataset.tab;
        const activeSwiper = swiperInstances.find(swiper =>
          swiper.el.closest(`#${panelId}`)
        );
        if (activeSwiper) {
          window.updateFraction(activeSwiper, '.featured-collections-fraction');
        }
      }
    });
  });
</script>
 -->

{% schema %}
{
  "name": "Featured Collection Tabs",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    }
  ],
  "blocks": [
    {
      "type": "collection_tab",
      "name": "Collection Tab",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Select Collection"
        },
        {
          "type": "text",
          "id": "collection_title",
          "label": "Tab Title"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured Collection Tabs"
    }
  ]
}
{% endschema %}

