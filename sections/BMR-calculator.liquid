{{ 'multiple-calculators.css' | asset_url | stylesheet_tag }}
<div class="main">
  <div class="xgen-inner">
  <div class="cal-header">
    {% if section.settings.header_image != blank %}
  		<img src="{{section.settings.header_image | img_url: 'master'}}" alt="section.settings.header_image">
    {% endif %}
  	
    {% if section.settings.title != blank %}
    	<h3 style>{{section.settings.title}}</h3>
    {% endif %}
    
    {% if section.settings.detail != blank %}
    	<p>{{section.settings.detail}}</p>
    {% endif %}
  
  </div>
  
  <form id="email_signup" class="tlc-form klaviyo_styling klaviyo_gdpr_embed_VDcQnv" action="//manage.kmail-lists.com/subscriptions/subscribe" data-ajax-submit="//manage.kmail-lists.com/ajax/subscriptions/subscribe" method="GET" target="_blank">
    <input type="hidden" name="calculator-name" value="bmr">
    
    <input type="hidden" name="g" value="VDcQnv">
    <input type="hidden" name="$fields" value="$consent">
    <input type="hidden" name="$list_fields" value="$consent">
    
    
    <div class="form-group gender">
      	<label class="main-label">GENDER</label>
        <input type="radio" class="fgender" name="fgender" value="female" id="female"><label for="female" class="label2">{% render 'xicon-femail' %} Female</label>
        <input type="radio" class="fgender" name="fgender" value="male" checked="" id="male"><label for="male" class="label2">{% render 'xicon-mail' %} Male</label>
        <!-- <input type="radio" class="fgender" name="fgender" value="other" id="other"><label for="other" class="label2">{% render 'xicon-other' %} Other</label> -->
    </div>
    
    
    <span style="color:red;font-size:10px;" class="height_msg"></span>
	<div class="form-group cominput">
      <label for="height" class="main-label">Height<super>*</super></label>
      <div class="input-group">
        <input type="number" name="height" value="" required="" placeholder="" id="height" min="1">
        <input type="radio" name="height-unit" value="in" checked id="heightin"><label for="heightin" class="label2">in</label>
        <input type="radio" name="height-unit" value="cm" id="heightcm" ><label for="heightcm" class="label2">cm</label>
      </div>
    </div>
    <span style="color:red;font-size:10px;" class="weight_msg"></span>
    <div class="form-group cominput">
      <label for="weight" class="main-label">Weight<super>*</super></label>
      <div class="input-group">
        <input type="number" id="weight" name="weight" value="" placeholder="" required=""  min="1">
        <input type="radio" name="weight-unit" value="lbs" required="" id="weightlbs"><label for="weightlbs" class="label2">lbs</label>
        <input type="radio" name="weight-unit" value="kg" required="" checked id="weightkg"><label for="weightkg" class="label2">kg</label>
        
      </div>
    </div>
    
    
    <span style="color:red;font-size:10px;" class="age_msg"></span>
    <div class="form-group">
      <label for="age" class="main-label">Age<super>*</super></label>
      <div class="input-group">
        <input type="number" name="age" value="" id="age" placeholder="" required=""  min="1">
        <span>years</span>
      </div>
    </div>
    <div class="form-group mygoal">
		<!-- add hideshow class to make this option available for womens -->
            <label class="main-label">My Lifestyle</label>
          	<div class="input-group">
              <input type="radio" name="Lifestyle" value="1.2" checked id="Lifestyleone">
              <label for="Lifestyleone" class="label2">
                {% render 'xicon-sedentary' %} 
                <p>Sedentary<br><span>Spend most of the day sitting ie. Working on computer, no exercise)</span></p>
                {% render 'xicon-check' %}
              </label>
              
              <input type="radio" name="Lifestyle" value="1.375"  id="Lifestyletwo">
              <label for="Lifestyletwo" class="label2">
                {% render 'xicon-light-activity' %} 
                <p>Light Activity <br><span>Spend a good part of the day on my feet (ie. Teacher, Real Estate)</span></p>
                {% render 'xicon-check' %}
              </label>
              
              
              <input type="radio" name="Lifestyle" value="1.55"  id="Lifestylethree">
              <label for="Lifestylethree" class="label2">
                {% render 'xicon-active' %} 
                <p>Active <br><span>Spend a good part of the day doing physical activites (ie. Waitress, UPS Driver)</span></p> 
                {% render 'xicon-check' %}
              </label>
              
              
              <input type="radio" name="Lifestyle" value="1.725"  id="Lifestylefour">
              <label for="Lifestylefour" class="label2">
                {% render 'xicon-very-active' %} 
                <p>Very Active <br><span>Spend a good part of the day doing heavy physical activites (ie. Brick Layer, Mover)</span></p> 
                {% render 'xicon-check' %}
              </label>
              
            </div>
		</div>
    	<span style="color:red;font-size:10px;" class="email_msg"></span>
     	<div class="form-group email">
            <label for="email" class="main-label">Email Address<super>*</super></label>
          	<div class="input-group">
              <input type="text" name="email" placeholder="name@example.com"  id="email">
            </div>
		</div>
      	<div class="form-group agree">
          	<div class="input-group">
              <input type="checkbox" name="term1" id="chkboxone"><label for="chkboxone" class="label2">I understand that the results provided by this calculator are estimations based on scientific and clinical data and are not intended to replace advice from a qualified healthcare professional. Always consult with a physician or dietitian before starting a new diet or exercise program.</label>
            </div>
		</div>
      	<div class="form-group agree">
          	<div class="input-group">
              <input type="checkbox" name="term2"  id="chkboxtwo" checked><label for="chkboxtwo" class="label2">Transparent Labs can occationally send me product recommendations and promotional emails.</label>
            </div>
		</div>

    
    <div class="form-group">
      <button type="button" class="bmrbtn" disabled>Calculate</button>
      <!-- <input type="button" class="bmrbtn button w-full" value="Calculate" disabled> -->
    </div>
    
  </form>
	<div class="results" style="display:none;">
      <p>Output (Results)</p>
      <p class="bmranswer"></p>
  	</div>
	</div> 
  <div class="max-w-6xl mx-auto px-4 text-blue-500 bmr-resourse-detail">
        	<div class="rich-text py-8 space-y-4">
             	{% if section.settings.resources_heading != blank %}<h2 class="">{{section.settings.resources_heading}}</h2>{% endif %}
             	{% if section.settings.resources_detail != blank %}<p class="">{{section.settings.resources_detail}}</p>{% endif %}
              	{% if section.settings.references_heading != blank %}<h2 class="">{{section.settings.references_heading}}</h2>{% endif %}
                {% if section.settings.references_detail != blank %}<p class="">{{section.settings.references_detail}}</p>{% endif %}
            </div>
		</div>
</div>
<style>
  .bmrbtn:disabled{background-color:#6fc6ed;cursor: no-drop;}
  super{color:red;}
  .bmrbtn:disabled {    background-color: #bddeed;    cursor: no-drop;}
  
</style>
 <script type="text/javascript" src="//www.klaviyo.com/media/js/public/klaviyo_subscribe.js"></script>
 <script>
     $(document).ready(function()
	{
  		$("#chkboxone").change("click", function () 
		{
			if (this.checked)
            {
              	$(".bmrbtn").attr('disabled', false);
            }
            if (!this.checked)
            {
              	$(".bmrbtn").attr('disabled', true);
            }
  		});
	});
   
   KlaviyoSubscribe.attachToForms('#email_signup', {
     success: function ($form) {
       console.log($form);
       var formdata = $("#email_signup").serialize();
       window.location.href = "https://www.transparentlabs.com/pages/calculator-results?"+formdata;
       var email = $form.find('[name="email"]').val();
       _learnq.push(['identify', { $email: email }]);
       _learnq.push(['track', 'Signed Up for Newsletter']);
     },
     hide_form_on_success: true,
     extra_properties: {
       $source: '$embed',
       $method_type: "Klaviyo Form",
       $method_id: 'embed',
       $consent_version: 'Embed default text'
     }
   });
   
$(document).ready(function() {
  
  // Enable/Disable BMR button based on checkbox state
  $("#chkboxone").change(function () {
    $(".bmrbtn").attr('disabled', !this.checked);
  });

  // Validate height on change
  $("#height").on('change', function () {
    var height = parseFloat($(this).val());
    if (isNaN(height) || height <= 0) {
      $(".height_msg").text("Please enter a valid height greater than 0!");
      $(".bmrbtn").attr('disabled', true);
    } else {
      $(".height_msg").text("");
      checkAllFields();
    }
  });

  // Validate weight on change
  $("#weight").on('change', function () {
    var weight = parseFloat($(this).val());
    if (isNaN(weight) || weight <= 0) {
      $(".weight_msg").text("Please enter a valid weight greater than 0!");
      $(".bmrbtn").attr('disabled', true);
    } else {
      $(".weight_msg").text("");
      checkAllFields();
    }
  });

  // Validate age on change
  $("#age").on('change', function () {
    var age = parseFloat($(this).val());
    if (isNaN(age) || age <= 0) {
      $(".age_msg").text("Please enter a valid age greater than 0!");
      $(".bmrbtn").attr('disabled', true);
    } else {
      $(".age_msg").text("");
      checkAllFields();
    }
  });

  // Validate email on change
  $("#email").on('change', function () {
    var email = $(this).val();
    var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/; 
    var email_ex = regex.test(email);

    if (!email_ex) {
      $(".email_msg").text("Please enter a valid email!");
      $(".bmrbtn").attr('disabled', true);
    } else {
      $(".email_msg").text("");
      checkAllFields();
    }
  });

  // Function to enable BMR button only if all fields are valid
  function checkAllFields() {
    var height = parseFloat($("#height").val());
    var weight = parseFloat($("#weight").val());
    var age = parseFloat($("#age").val());
    var email = $("#email").val();
    var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
    var email_ex = regex.test(email);

     // Enable button only if all fields are valid and checkbox is checked
    if (!isNaN(height) && height > 0 &&
        !isNaN(weight) && weight > 0 &&
        !isNaN(age) && age > 0 &&
        email_ex && $("#chkboxone").is(':checked')) {
      $(".bmrbtn").attr('disabled', false);
    } else {
      $(".bmrbtn").attr('disabled', true);
    }
  }

   function calculateBMR(age, gender, weight, height, weightUnit, heightUnit) {

     console.log(age, gender, weight, height, weightUnit, heightUnit);
    // Convert weight from lbs to kg if needed
    if (weightUnit === "lbs") {
      weight = weight / 2.205;
    }

    // Convert height from inches to cm if needed
    if (heightUnit === "in") {
      height = height * 2.54;
    }

    // Calculate BMR based on gender
    let bmr;
    if (gender === "male") {
      bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
    } else if (gender === "female") {
      bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
    }

    // Return BMR only if it was calculated, otherwise return null
    return bmr ? bmr.toFixed(1) + " kcal/day" : null;
  }

  // Handle BMR button click event
  $(".bmrbtn").click(function(event){
    event.preventDefault();

    var gender = $("input[name='fgender']:checked").val();  // Get selected gender
    var heightUnit = $("input[name='height-unit']:checked").val();  // Get selected gender
    var weightUnit = $("input[name='weight-unit']:checked").val();  // Get selected gender
    var height = parseFloat($("#height").val());
    var weight = parseFloat($("#weight").val());
    var age = parseFloat($("#age").val());
    var email = $("#email").val();

    // Initialize flag to check if there are validation errors
    var flag = 0;

    // Check each field for final validation
    if (isNaN(height) || height <= 0) {
      $(".height_msg").text("Please enter a valid height greater than 0!");
      flag = 1;
    }
    if (isNaN(weight) || weight <= 0) {
      $(".weight_msg").text("Please enter a valid weight greater than 0!");
      flag = 1;
    }
    if (isNaN(age) || age <= 0) {
      $(".age_msg").text("Please enter a valid age greater than 0!");
      flag = 1;
    }
    if (!/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(email)) {
      $(".email_msg").text("Please enter a valid email!");
      flag = 1;
    }

    // Submit the form if no validation errors
    if (flag === 0) {
      // $("#email_signup").submit();
      // Calculate BMR and display result
      var bmrResult = calculateBMR(age, gender, weight, height, weightUnit, heightUnit);
      $(".results").show();
      $(".bmranswer").text("Your BMR is: " + bmrResult);  // Display in a result div
    }
  });

});



</script>

{% schema %}
  {
    "name": "BMR-calculator",
    "settings": [
	
	{
		"type":"image_picker",
		"id":"header_image",
		"label":"Choose image"
	},
	{
		"type":"text",
		"id":"title",
		"label":"Title"
	},
	{
		"type":"textarea",
		"id":"detail",
		"label":"Subtitle"
	},
	{
    	"type":"text",
        "id":"resources_heading",
        "label":"Resources heading"
	},
    {
        "type":"richtext",
        "id":"resources_detail",
        "label":"Resources details"
    },
    {
        "type":"text",
        "id":"references_heading",
        "label":"References heading"
     },
    {
    	"type":"richtext",
    	"id":"references_detail",
    	"label":"References details"
    }
	
],
"presets":[
		{
			"name": "BMR-calculator"
		}
	]
  }
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}

