{%- style -%}
  #shopify-section-{{ section.id }}{
    --bg-overlay--desktop: {{ section.settings.bg_color_desktop }};
    --bg-overlay--mobile: {{ section.settings.bg_color_mobile }};
  }
{%- endstyle -%}

{% stylesheet %}
  .sb-featured-media {
    position: relative;
    width: 100%;
    display: flex;
    align-items: flex-end;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    color: var(--sb-fg-color, #FFFFFF);
    padding: var(--sb-padding-top-mobile, 48px) 0 var(--sb-padding-bottom-mobile, 48px);
    min-height: 457px;
  }

  .sb-featured-media__media {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    z-index: 1;
    display: flex;
    min-height: 457px;
  }

  .sb-featured-media__overlay {
    position: absolute;
    display: block !important;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 2;
    background: var(--bg-overlay--mobile, transparent);
    pointer-events: none;
  }

  .sb-featured-media__media img,
  .sb-featured-media__media video {
    width: 100%;
    height: auto;
    object-fit: cover;
  }

  .sb-featured-media__video--desktop{
    display: none;
  }

  .sb-featured-media__content {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 3;
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding-block: 44px;
    padding-inline: var(--sb-padding-inline, 16px);
  }

  .sb-featured-media__text-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
  }

  .sb-featured-media__heading {
    font-family: var(--sb-font-family-heading);
    font-size: 28px;
    line-height: 1.2;
    color: var(--sb-fg-color, #FFFFFF);
    margin: 0;
    text-transform: capitalize;
  }

  .sb-featured-media__cta {
    margin-top: auto;
    background: transparent;
  }

  .sb-featured-media__cta .sb-button a:hover {
    background: #fff3 !important;
  }

  .sb-featured-media__cta .sb-button, .sb-featured-media__cta .sb-button a{
    background: transparent !important;
  }

  @media screen and (min-width: 1024px) {
    .sb-featured-media {
      max-height: 468px;
      padding: var(--sb-padding-top, 88px) 0 var(--sb-padding-bottom, 88px);
    }

    .sb-featured-media__video--desktop{
      display: block;
      max-height: 468px;
    }

    .sb-featured-media__video--mobile{
      display: none;
    }

    .sb-featured-media__overlay {
      background: var(--bg-overlay--desktop, var(--bg-overlay--mobile, transparent));
    }

    .sb-featured-media__content{
      margin-left: max(calc((100vw - var(--page-width)) / 2), 0px);
      max-width: var(--page-width);
      padding-block: 88px;
    }
    .sb-featured-media__heading {
      font-size: 40px;
      max-width: 540px;
    }

    .sb-featured-media__cta {
      align-self: flex-start;
    }

    .sb-featured-media__cta .sb-button__link {
      width: 312px;
      padding: 16px 10px 18px;
      line-height: 1;
    }
  }
  @media screen and (min-width: 1920px){
    .sb-featured-media__cta .sb-button__link {
      width: 400px;
    }
    .sb-featured-media__content{
      padding-inline: 0;
    }
  }
{% endstylesheet %}

<div class="sb-featured-media sb-styled-element" style="{%  render 'style-attributes', settings: section.settings %}">
  <!-- Media Background -->
  <div class="sb-featured-media__media">
    {% if section.settings.media_source == 'image' %}
      {% if section.settings.mobile_img != blank %}
        <picture>
          {% if section.settings.desktop_img != blank %}
            <source media="(min-width: 1024px)" srcset="{{ section.settings.desktop_img | image_url: width: 1920 }}">
          {% endif %}
          {{ section.settings.mobile_img | image_url: width: 768 | image_tag: loading: 'eager', width: 768, height: 768, alt: section.settings.heading }}
        </picture>
      {% elsif section.settings.desktop_img != blank %}
        {{ section.settings.desktop_img | image_url: width: 1920 | image_tag: loading: 'eager', width: 1920, height: 1080, alt: section.settings.heading }}
      {% endif %}
    {% else %}
      {% if section.settings.mobile_video != blank %}
        {{
          section.settings.mobile_video
          | video_tag:
            image_size: '1100x',
            autoplay: true,
            loop: section.settings.enable_video_looping,
            controls: false,
            muted: true,
            class: 'sb-featured-media__video--mobile'
        }}
      {% endif %}
      {% if section.settings.desktop_video != blank %}
        {{
          section.settings.desktop_video
          | video_tag:
            image_size: '1920x',
            autoplay: true,
            loop: section.settings.enable_video_looping,
            controls: false,
            muted: true,
            class: 'sb-featured-media__video--desktop'
        }}
      {% endif %}
    {% endif %}
    
    <!-- Overlay -->
    {% if section.settings.show_overlay == true %}
      <div class="sb-featured-media__overlay"></div>
    {% endif %}
  </div>

  <!-- Content Overlay -->
  <div class="sb-featured-media__content">
    <div class="sb-featured-media__text-content">
      {% if section.settings.heading != blank %}
        <h2 class="sb-featured-media__heading">{{ section.settings.heading }}</h2>
      {% endif %}
    </div>
    
    {% if section.settings.button_text != blank and section.settings.button_url != blank %}
      <div class="sb-featured-media__cta">
        {% render 'sb-button', button: section.settings %}
      </div>
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "SB Featured Media",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Every ingredient matters to make every effort count."
    },
    {
      "type": "header",
      "content": "Call to Action"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Shop Best Sellers"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button URL"
    },
    {
      "type": "select",
      "id": "button_type",
      "label": "Button Type",
      "options": [
        {
          "value": "primary",
          "label": "Primary"
        },
        {
          "value": "secondary",
          "label": "Secondary"
        },
        {
          "value": "link",
          "label": "Link"
        },
        {
          "value": "outline",
          "label": "Outline"
        }
      ],
      "default": "primary"
    },
    {
      "type": "header",
      "content": "Media"
    },
    {
      "type": "select",
      "id": "media_source",
      "options": [
        {
          "value": "image",
          "label": "Image"
        },
        {
          "value": "video",
          "label": "Video"
        }
      ],
      "default": "image",
      "label": "Media Source"
    },
    {
      "type": "image_picker",
      "id": "mobile_img",
      "label": "Mobile Image",
      "visible_if": "{{ section.settings.media_source == 'image' }}"
    },
    {
      "type": "image_picker",
      "id": "desktop_img",
      "label": "Desktop Image",
      "visible_if": "{{ section.settings.media_source == 'image' }}"
    },
    {
      "type": "video",
      "id": "mobile_video",
      "label": "Mobile Video",
      "visible_if": "{{ section.settings.media_source == 'video' }}"
    },
    {
      "type": "video",
      "id": "desktop_video",
      "label": "Desktop Video",
      "visible_if": "{{ section.settings.media_source == 'video' }}"
    },
        {
      "type": "checkbox",
      "id": "enable_video_looping",
      "label": "Enable Video Looping",
      "default": true
      },
    {
      "type": "checkbox",
      "id": "show_overlay",
      "label": "Show Overlay on Media",
      "default": false
    },
    {
     "type": "color_background",
     "id": "bg_color_desktop",
     "label": "Background Overlay Desktop",
     "visible_if": "{{ section.settings.show_overlay == true }}"
    },
    {
      "type": "color_background",
      "id": "bg_color_mobile",
      "label": "Background Overlay Mobile",
      "visible_if": "{{ section.settings.show_overlay == true }}"
     },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "fg_color",
      "label": "Text Color",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button Color"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding Top",
      "default": 0,
      "min": 0,
      "max": 100
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding Bottom",
      "default": 0,
      "min": 0,
      "max": 100
    }
  ],
  "presets": [
    {
      "name": "SB Featured Media"
    }
  ]
}
{% endschema %}
